<mat-card (click)="$event.stopPropagation()"
          (contextmenu)="showContextMenu($event)"
          (dblclick)="open()"
          (mousedown)="onMouseDown($event)"
          (mousemove)="onMouseMove($event)"
          (mouseup)="onMouseUp($event)"
          [class.docked-left]="image.posX === 0"
          [class.docked-top]="image.posY === 49"
          [matRippleDisabled]="rippleDisabled"
          class="flex-container" matRipple
          [highlightColor]="undefined"
          [highlightedItem]="image"
          style="padding: 5px 5px 0 5px; min-height: 32px">
  <div *ngIf="!imageLoaded" class="image-link">
    {{ image.source }}
  </div>
  <img (load)="onImageLoaded()" [class.hide]="!imageLoaded" [src]="image.source" alt="loading failed"
       class="animated" height="140" style="border-radius: 8px">
  <div class="img-button-group">
    <button (mousedown)="rippleDisabled=true"
            (mouseup)="showContextMenu($event)"
            mat-icon-button>
      <mat-icon>more_vert</mat-icon>
    </button>
  </div>
</mat-card>

<div [matMenuTriggerFor]="contextMenu"
     [style.left.px]="rightClickPosX"
     [style.top.px]="rightClickPosY"
     style="visibility: hidden; position: fixed">
</div>
<mat-menu #contextMenu="matMenu">
  <div
    [highlightColor]="undefined"
    [highlightedItem]="image"
    [x]="rightClickPosX" [y]="rightClickPosY">
    <ng-container *ngIf="!dataService.selectedItemsCount">
      <button (click)="dataService.bringToFront(this.image)" mat-menu-item>
        <mat-icon>flip_to_front</mat-icon>
        {{ 'DRAGGABLE.BRING_TO_FRONT' | translate }}
      </button>
      <button (click)="dataService.bringForward(this.image)" mat-menu-item>
        <mat-icon>add_circle_outline</mat-icon>
        {{ 'DRAGGABLE.BRING_FORWARD' | translate }}
      </button>
      <button (click)="dataService.sendBackward(this.image)" mat-menu-item>
        <mat-icon>remove_circle_outline</mat-icon>
        {{ 'DRAGGABLE.SEND_BACKWARD' | translate }}
      </button>
      <button (click)="dataService.flipToBack(this.image)" mat-menu-item>
        <mat-icon>flip_to_back</mat-icon>
        {{ 'DRAGGABLE.SEND_TO_BACK' | translate }}
      </button>
      <ng-container *ngIf="dataService.tabs.length > 1">
        <button [matMenuTriggerFor]="tabs" mat-menu-item>
          <mat-icon>drive_file_move</mat-icon>
          {{ 'DRAGGABLE.MOVE' | translate }}
        </button>
      </ng-container>
      <button (click)="open()" mat-menu-item>
        <mat-icon>open_in_new</mat-icon>
        {{ 'IMAGE.OPEN_LINK' | translate }}
      </button>
      <button (click)="copy()" mat-menu-item>
        <mat-icon>content_copy</mat-icon>
        {{ 'IMAGE.COPY_LINK' | translate }}
      </button>
    </ng-container>
    <button *ngIf="!image.selected" (click)="select()" mat-menu-item>
      <mat-icon>check</mat-icon>
      {{ 'DRAGGABLE.SELECT' | translate }}
    </button>
    <button *ngIf="image.selected" (click)="select()" mat-menu-item>
      <mat-icon>close</mat-icon>
      {{ 'DRAGGABLE.REMOVE_SELECTION' | translate }}
    </button>
    <ng-container *ngIf="!dataService.selectedItemsCount">
      <button (click)="delete($event, true)" mat-menu-item>
        <mat-icon>delete</mat-icon>
        {{ 'DRAGGABLE.DELETE' | translate }}
      </button>
    </ng-container>
  </div>
</mat-menu>

<mat-menu #tabs="matMenu">
  <ng-container *ngFor="let tab of dataService.tabs">
    <button (click)="moveToTab(tab.index)" *ngIf="dataService.selectedTabIndex != tab.index" mat-menu-item>
      {{ tab.label ? tab.label : '#Board ' + (tab.index + 1) }}
    </button>
  </ng-container>
</mat-menu>
