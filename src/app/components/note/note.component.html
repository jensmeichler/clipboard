<mat-card (click)="$event.stopPropagation()" (contextmenu)="showContextMenu($event)"
          (mousedown)="onMouseDown($event)"
          (mousemove)="onMouseMove()"
          (mouseup)="onMouseUp($event)"
          [matRippleDisabled]="rippleDisabled"
          [style.background]="note.backgroundColorGradient
            ? 'linear-gradient(to bottom, ' + note.backgroundColor + ', ' + note.backgroundColorGradient
            : note.backgroundColor"
          [style.color]="note.foregroundColor"
          matRipple>
  <mat-card-title *ngIf="note.header" class="flex-container">
    {{note.header}}
  </mat-card-title>
  <mat-card-content [innerHTML]="parsedContent"></mat-card-content>
  <mat-card-actions align="end">
    <button (click)="edit($event)" (mousedown)="rippleDisabled=true"
            mat-icon-button>
      <mat-icon>edit</mat-icon>
    </button>
    <button (click)="delete($event)" (mousedown)="rippleDisabled=true"
            mat-icon-button>
      <mat-icon>delete</mat-icon>
    </button>
    <button (click)="showContextMenu($event)" (mousedown)="rippleDisabled=true"
            mat-icon-button>
      <mat-icon>more_vert</mat-icon>
    </button>
  </mat-card-actions>
  <mat-card-footer [style.margin-bottom.px]="-32"></mat-card-footer>
</mat-card>

<div [matMenuTriggerFor]="contextMenu"
     [style.left.px]="rightClickPosX"
     [style.top.px]="rightClickPosY"
     style="visibility: hidden; position: fixed">
</div>
<mat-menu #contextMenu="matMenu">
  <div [style.background]="note.backgroundColorGradient
            ? 'linear-gradient(to bottom, ' + note.backgroundColor + ', ' + note.backgroundColorGradient
            : note.backgroundColor"
       [style.color]="note.foregroundColor">
    <button (click)="dataService.bringToFront(this.note)" mat-menu-item>
      <mat-icon>flip_to_front</mat-icon>
      Bring to front
    </button>
    <button (click)="dataService.bringForward(this.note)" mat-menu-item>
      <mat-icon>add_circle_outline</mat-icon>
      Bring forward
    </button>
    <button (click)="dataService.sendBackward(this.note)" mat-menu-item>
      <mat-icon>remove_circle_outline</mat-icon>
      Send backward
    </button>
    <button (click)="dataService.flipToBack(this.note)" mat-menu-item>
      <mat-icon>flip_to_back</mat-icon>
      Send to back
    </button>
    <ng-container *ngIf="dataService.tabs.length > 1">
      <button [matMenuTriggerFor]="tabs" mat-menu-item>
        <mat-icon>drive_file_move</mat-icon>
        Move
      </button>
    </ng-container>
    <ng-container *ngIf="dataService.getColorizedObjects(note).length > 1">
      <button [matMenuTriggerFor]="items" mat-menu-item>
        <mat-icon>colorize</mat-icon>
        Copy other color
      </button>
    </ng-container>
    <ng-container *ngIf="dataService.getColorizedObjects(note).length == 1">
      <button (click)="copyColorFrom(dataService.getColorizedObjects(note)[0])" mat-menu-item>
        <mat-icon>colorize</mat-icon>
        Copy other color
      </button>
    </ng-container>
    <button (click)="copy()" mat-menu-item>
      <mat-icon>content_copy</mat-icon>
      Copy value
    </button>
    <button (click)="select()" mat-menu-item>
      <mat-icon>{{note.selected ? 'close' : 'check'}}</mat-icon>
      {{note.selected ? 'Remove selection' : 'Select'}}
    </button>
    <button (click)="edit($event)" mat-menu-item>
      <mat-icon>edit</mat-icon>
      Edit
    </button>
    <button (click)="delete($event)" mat-menu-item>
      <mat-icon>delete</mat-icon>
      Delete
    </button>
  </div>
</mat-menu>

<mat-menu #tabs="matMenu">
  <div [style.background]="note.backgroundColorGradient
            ? 'linear-gradient(to bottom, ' + note.backgroundColor + ', ' + note.backgroundColorGradient
            : note.backgroundColor"
       [style.color]="note.foregroundColor">
    <ng-container *ngFor="let tab of dataService.tabs">
      <button (click)="moveToTab(tab.index)" *ngIf="dataService.currentTabIndex != tab.index" mat-menu-item>
        {{tab.label ? tab.label : '#Board ' + (tab.index + 1)}}
      </button>
    </ng-container>
  </div>
</mat-menu>

<mat-menu #items="matMenu">
  <ng-container *ngFor="let item of dataService.getColorizedObjects(note)">
    <button (click)="copyColorFrom(item)" *ngIf="note !== item" [style.background]="item.backgroundColorGradient
                ? 'linear-gradient(to bottom, ' + item.backgroundColor + ', ' + item.backgroundColorGradient
                : item.backgroundColor"
            [style.color]="item.foregroundColor"
            mat-menu-item>
      <mat-icon>color_lens</mat-icon>
      <ng-container *ngIf="!item.backgroundColorGradient">
        {{item.backgroundColor}}
      </ng-container>
      <ng-container *ngIf="item.backgroundColorGradient">
        {{ item.backgroundColor + ' â†’ ' + item.backgroundColorGradient }}
      </ng-container>
    </button>
  </ng-container>
</mat-menu>
